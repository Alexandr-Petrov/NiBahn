<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Nibahn: src/Nibahn.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Nibahn
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Nibahn.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This is the main file of the Nibahn Project, used functions will be called from there.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;nibo/niboconfig.h&gt;</code><br />
<code>#include &lt;nibo/iodefs.h&gt;</code><br />
<code>#include &lt;nibo/bot.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;nibo/delay.h&gt;</code><br />
<code>#include &lt;nibo/copro.h&gt;</code><br />
<code>#include &lt;nibo/floor.h&gt;</code><br />
<code>#include &lt;nibo/spi.h&gt;</code><br />
<code>#include &lt;avr/interrupt.h&gt;</code><br />
<code>#include &lt;nibo/leds.h&gt;</code><br />
<code>#include &quot;<a class="el" href="x_bee_8h_source.html">xBee.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="protokoll_8h_source.html">protokoll.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_nibo__actions_8h_source.html">Nibo_actions.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_nibahn_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a> ()</td></tr>
<tr class="memdesc:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">libraries for standard functions of the Nibo2  <a href="_nibahn_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">More...</a><br /></td></tr>
<tr class="separator:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is the main file of the Nibahn Project, used functions will be called from there. </p>
<dl class="section author"><dt>Author</dt><dd>Alexandr Petrov and Jan Bischof</dd></dl>
<dl class="section version"><dt>Version</dt><dd>04.12.2019 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ae66f6b31b5ad750f1fe042a706a4e3d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae66f6b31b5ad750f1fe042a706a4e3d4">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>libraries for standard functions of the Nibo2 </p>
<p>library for standard input and output operations of the Nibo2 includes interrupts delay functions include delay operations includes library for interaction with floor sensors includes SPI communication library includes microcontroller hardware interrupts library for control of the LEDs includes xBee Communication includes functions and data types for xBee communication in Nibahn Project includes functions for Nibo</p>
<p>Main function of the <a class="el" href="_nibahn_8c.html" title="This is the main file of the Nibahn Project, used functions will be called from there.">Nibahn.c</a> file. Does the main calculations and controls the behavior of Nibo </p>
<p>initialize the LEDs</p>
<p>initialize the robot</p>
<p>initialize spi-port</p>
<p>initialize the floor sensors</p>
<p>declare and initialize a variable for storing received bytes</p>
<p>initialize xBee Module</p>
<p>for saving the values gotten from the sensors</p>
<p>for saving the current Speed value and setting the reelection_delay</p>
<p>for saving the flag values</p>
<p>for saving the ID of the Nibo and maximum number of Nibos in the chain</p>
<p>Operation loop</p>
<p>if Nibo is the master</p>
<p>Sets the front LEDs Orange</p>
<p>if Nibo is not participating in the chain</p>
<p>Sets the front LEDs Red</p>
<p>if Nibo is not a master</p>
<p>Sets the front LEDs Red</p>
<p>if send buffer is not full and the ID of this Nibo was not established yet</p>
<p>sets the flag of ID to established</p>
<p>forms the byte to claim the ID</p>
<p>sends the formed byte</p>
<p>if the receive buffer is not empty</p>
<p>-&gt; get next received data byte of the buffer</p>
<p>if it's a broadcast and not with the command from the second set or if it's sent to the ID of this Nibo</p>
<p>if it's sent from PC, Master or from the Nibo with the ID of this Nibo</p>
<p>if received byte has 00 in the commands set section and nibo participates in the chain commands set 1</p>
<p>line will not be ignored if nibo gets anything from this set of commands</p>
<p>if received byte has 00 in the commands section</p>
<p>speed of the Nibo will be increased</p>
<p>if received byte has 01 in the commands section</p>
<p>speed of the Nibo will be decreased</p>
<p>if received byte has 10 in the commands section</p>
<p>setting the flag to 0 to mark that ID is not established</p>
<p>Nibo will turn 180 degrees left</p>
<p>Nibo will enter the reelection mode and get the starting ID (1) later, to participate in the reelection</p>
<p>if received byte has 11 in the commands section</p>
<p>setting the flag to 0 to mark that ID is not established</p>
<p>Nibo will turn 180 degrees right</p>
<p>Nibo will will enter the reelection mode and get the starting ID (1) later, to participate in the reelection</p>
<p>if received byte has 01 in the commands set section commands Set 2</p>
<p>line will be ignored if nibo gets anything from this set of commands</p>
<p>if received byte has 00 in the commands section</p>
<p>Speed of the Nibo will be increased</p>
<p>if received byte has 01 in the commands section</p>
<p>Speed of the Nibo will be decreased</p>
<p>if received byte has 10 in the commands section</p>
<p>Nibo will turn 90 degrees left</p>
<p>if received byte has 11 in the commands section</p>
<p>Nibo will turn 90 degrees right</p>
<p>if received byte has 10 in the commands set section commands set 3</p>
<p>if received byte has 00 in the commands section</p>
<p>if send buffer is not full</p>
<p>the byte to force other Nibo to select another ID is formed</p>
<p>byte sent</p>
<p>if received byte has 01 in the commands section this will be true only if some other Nibo claimed current ID of this Nibo before</p>
<p>increment own ID</p>
<p>setting the flag to 0 to mark that ID is not established</p>
<p>if received byte has 10 in the commands section</p>
<p>will start the forced reelection process</p>
<p>setting the flag to 0 to mark that ID is not established</p>
<p>if received byte has 11 in the commands section</p>
<p>if send buffer is not full</p>
<p>set the ID of the Nibo 00 effectively switching it off from the chain</p>
<p>forms the byte that will start reelection through the broadcast</p>
<p>send the formed byte</p>
<p>if received byte has 11 in the commands set section commands set 4</p>
<p>If received byte has 00 in the commands section and ID of the sender Nibo is lower than of this Nibo</p>
<p>sets the speed to 0</p>
<p>speed of the wheels will be 0 for the fixed period of time</p>
<p>Reserved for new functions</p>
<p>get the actual values from the floor sensors</p>
<p>update the values in the coprocessor</p>
<p>get the values from the right sensor near the line</p>
<p>if black line is detected by the right line sensor and flag states that line shouldn't be ignored</p>
<p>if send buffer is not full</p>
<p>forms the byte that will stop all Nibos with lower IDs</p>
<p>sends the formed byte</p>
<p>slightly turns to the right</p>
<p>get the values from the left sensor near the line</p>
<p>if black line is detected by the left line sensor and flag states that line shouldn't be ignored</p>
<p>if send buffer is not full</p>
<p>forms the byte that will stop all Nibos with lower IDs</p>
<p>sends the formed byte</p>
<p>slightly turns to the right</p>
<p>if black line is not detected</p>
<p>set the speed to it's current value defined by the Speed variable</p>
<p>if both sensors simultaneously detect the black line and flag states that line shouldn't be ignored</p>
<p>move back a little</p>
<p>some delay to slow down any action and give some time to turn or roll back</p>
<p>end of the main program</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
